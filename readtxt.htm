<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‰“å¡ç´€éŒ„æŸ¥è©¢</title>

<style>
body {
  font-family: sans-serif;
  padding: 20px;
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #ccc;
  padding: 8px;
  font-size: 14px;
}
th {
  background: #f0f0f0;
}
tr:nth-child(even) {
  background: #fafafa;
}
#loading {
  font-size: 18px;
  color: #666;
}
</style>
</head>

<body>

<h2>ğŸ“„ æœ€è¿‘ 60 å¤©æ‰“å¡ç´€éŒ„</h2>
<div id="loading">è®€å–ä¸­...</div>

<table id="table" style="display:none">
  <thead>
    <tr>
      <th>æ™‚é–“</th>
      <th>é›»è©±</th>
      <th>åœ°é»</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<script>
/* ========= è¨­å®š ========= */

const GIST_ID = "128158194ad773c072ca111b84286cfb";
const TK_HEX = "6768705F4A3052654D6C75636C6B614B785A63494C4379316C5077754458486C5150313955304361";

function hexToString(hex) {
  let s = '';
  for (let i = 0; i < hex.length; i += 2)
    s += String.fromCharCode(parseInt(hex.substr(i, 2), 16));
  return s;
}
const TOKEN = hexToString(TK_HEX);

/* ========= è®€å– Gist ========= */

async function loadAllRecords() {
  const res = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
    headers: {
      "Authorization": `token ${TOKEN}`,
      "Accept": "application/vnd.github+json"
    }
  });

  if (!res.ok) {
    document.getElementById("loading").innerText = "âŒ è®€å–å¤±æ•—";
    return;
  }

  const data = await res.json();
  const files = data.files;

  const now = Date.now();
  const DAYS_60 = 60 * 24 * 60 * 60 * 1000;

  let rows = [];

  for (const filename in files) {
    if (!filename.endsWith(".txt")) continue;

    const content = files[filename].content || "";
    const lines = content.split("\n");

    for (const line of lines) {
      const parts = line.trim().split("\t");
      if (parts.length < 4) continue;

      const time = Date.parse(parts[1]);
      if (isNaN(time)) continue;

      if (now - time <= DAYS_60) {
        rows.push({
          time,
          timeText: parts[1],
          tel: parts[2],
          location: parts[3]
        });
      }
    }
  }

  // æ–° â†’ èˆŠæ’åº
  rows.sort((a, b) => b.time - a.time);

  const tbody = document.getElementById("tbody");
  rows.forEach(r => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.timeText}</td>
      <td>${r.tel}</td>
      <td>${r.location}</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById("loading").style.display = "none";
  document.getElementById("table").style.display = "table";
}

loadAllRecords();
</script>

</body>
</html>
